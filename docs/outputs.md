# Outputs

This guide explains the output files generated by SOLWEIG-GPU and how to interpret and visualize the results.

## Output Structure

After running a simulation, outputs are saved in the `Outputs/` directory within your `base_path`. The structure is organized by tiles:

```
base_path/
└── Outputs/
    ├── tile_0_0/
    │   ├── UTCI_0_0.tif
    │   ├── Tmrt_0_0.tif
    │   └── SVF_0_0.tif
    ├── tile_0_1000/
    │   ├── UTCI_0_1000.tif
    │   ├── Tmrt_0_1000.tif
    │   └── SVF_0_1000.tif
    └── tile_1000_0/
        ├── UTCI_1000_0.tif
        ├── Tmrt_1000_0.tif
        └── SVF_1000_0.tif
```

Each tile is named according to its origin coordinates in the raster grid (e.g., `tile_0_0`, `tile_0_1000`).

## Output Files

### Universal Thermal Climate Index (UTCI)

**Filename:** `UTCI_X_Y.tif`  
**Format:** Multi-band GeoTIFF  
**Units:** °C  
**Description:** The Universal Thermal Climate Index, representing the "feels like" temperature.

UTCI is always computed and saved. It provides a comprehensive measure of thermal comfort that accounts for air temperature, mean radiant temperature, wind speed, and humidity.

**Interpretation:**

| UTCI Range (°C) | Thermal Stress Category |
|----------------|------------------------|
| > 46 | Extreme heat stress |
| 38 to 46 | Very strong heat stress |
| 32 to 38 | Strong heat stress |
| 26 to 32 | Moderate heat stress |
| 9 to 26 | No thermal stress |
| 0 to 9 | Slight cold stress |
| -13 to 0 | Moderate cold stress |
| -27 to -13 | Strong cold stress |
| -40 to -27 | Very strong cold stress |
| < -40 | Extreme cold stress |

!!! info "UTCI Applications"
    UTCI is widely used in urban planning, public health, and climate adaptation studies. It provides a standardized measure that can be compared across different locations and climates.

### Mean Radiant Temperature (Tmrt)

**Filename:** `Tmrt_X_Y.tif`  
**Format:** Multi-band GeoTIFF  
**Units:** °C  
**Description:** The mean radiant temperature experienced by a person.

Tmrt represents the uniform temperature of an imaginary enclosure in which the radiant heat exchange with the human body equals the radiant heat exchange in the actual environment.

**Saved when:** `save_tmrt=True`

**Interpretation:**

Tmrt is typically higher than air temperature in sunny conditions due to solar radiation and can be significantly lower in shaded areas. The difference between Tmrt and air temperature indicates the importance of radiation in thermal comfort.

**Typical Values:**

- **Full sun:** Tmrt can be 20-30°C higher than air temperature
- **Full shade:** Tmrt is typically 0-5°C lower than air temperature
- **Partial shade:** Tmrt varies between these extremes

### Sky View Factor (SVF)

**Filename:** `SVF_X_Y.tif`  
**Format:** Single-band GeoTIFF  
**Units:** Dimensionless (0-1)  
**Description:** The fraction of the sky hemisphere visible from each point.

SVF is a geometric parameter that quantifies the openness of a location to the sky. It affects both shortwave and longwave radiation exchange.

**Saved when:** `save_tmrt=True`

**Interpretation:**

| SVF Value | Environment |
|-----------|-------------|
| 1.0 | Completely open (no obstructions) |
| 0.7-0.9 | Open urban areas, wide streets |
| 0.4-0.7 | Urban canyons, narrow streets |
| 0.2-0.4 | Heavily built-up areas |
| < 0.2 | Under dense canopy or deep canyons |

!!! note "SVF is Time-Independent"
    Unlike other outputs, SVF is a geometric property that doesn't change with time. It is saved as a single-band raster, not multi-band.

### Shortwave Radiation

#### Downwelling Shortwave (Kdown)

**Filename:** `Kdown_X_Y.tif`  
**Format:** Multi-band GeoTIFF  
**Units:** W/m²  
**Description:** Incoming shortwave (solar) radiation at the surface.

**Saved when:** `save_kdown=True`

Kdown includes both direct beam radiation and diffuse radiation from the sky, accounting for shading by buildings and vegetation.

#### Upwelling Shortwave (Kup)

**Filename:** `Kup_X_Y.tif`  
**Format:** Multi-band GeoTIFF  
**Units:** W/m²  
**Description:** Reflected shortwave radiation from surfaces.

**Saved when:** `save_kup=True`

Kup represents solar radiation reflected from the ground and walls, which contributes to the radiation budget.

### Longwave Radiation

#### Downwelling Longwave (Ldown)

**Filename:** `Ldown_X_Y.tif`  
**Format:** Multi-band GeoTIFF  
**Units:** W/m²  
**Description:** Incoming longwave (thermal) radiation.

**Saved when:** `save_ldown=True`

Ldown includes atmospheric radiation and thermal emission from surrounding surfaces (walls, ground).

#### Upwelling Longwave (Lup)

**Filename:** `Lup_X_Y.tif`  
**Format:** Multi-band GeoTIFF  
**Units:** W/m²  
**Description:** Outgoing longwave radiation from the surface.

**Saved when:** `save_lup=True`

Lup represents thermal emission from the ground and walls based on their temperature.

### Shadow Maps

**Filename:** `Shadow_X_Y.tif`  
**Format:** Multi-band GeoTIFF  
**Units:** Binary (0 or 1)  
**Description:** Shadow/sunlit classification for each pixel.

**Saved when:** `save_shadow=True`

**Values:**

- **0:** In shadow
- **1:** In direct sunlight

Shadow maps show which areas receive direct solar radiation at each time step. They account for shading by buildings and vegetation.

## Multi-Band Structure

Most outputs (except SVF) are saved as multi-band GeoTIFFs, where each band represents one hour of the simulation.

**Example:** For a 24-hour simulation starting at 00:00:

- Band 1: Hour 0 (00:00)
- Band 2: Hour 1 (01:00)
- Band 3: Hour 2 (02:00)
- ...
- Band 24: Hour 23 (23:00)

## Visualizing Outputs

### Using QGIS

1. **Open QGIS** and add the GeoTIFF file
2. **Multi-band rasters** will appear with all bands listed
3. **Select a specific band** to visualize a particular hour
4. **Apply color ramp** for better visualization:
   - For UTCI/Tmrt: Use a thermal color ramp (blue-red)
   - For SVF: Use a grayscale or inverted grayscale
   - For radiation: Use a sequential color ramp

!!! tip "Temporal Animation"
    In QGIS, you can use the Temporal Controller to animate the multi-band raster and see how UTCI changes throughout the day.

### Using Python

```python
from osgeo import gdal
import matplotlib.pyplot as plt
import numpy as np

# Open the UTCI file
ds = gdal.Open('Outputs/tile_0_0/UTCI_0_0.tif')

# Read a specific hour (e.g., hour 12 = noon)
band = ds.GetRasterBand(12)
utci = band.ReadAsArray()

# Plot
plt.figure(figsize=(10, 8))
plt.imshow(utci, cmap='RdYlBu_r', vmin=20, vmax=45)
plt.colorbar(label='UTCI (°C)')
plt.title('UTCI at Noon')
plt.axis('off')
plt.tight_layout()
plt.savefig('utci_noon.png', dpi=300)
plt.show()
```

### Using ArcGIS

1. **Add the GeoTIFF** to your map
2. **Access band properties** through the raster properties dialog
3. **Create a mosaic** if you have multiple tiles
4. **Apply symbology** using the Symbology pane
5. **Export maps** for publication or presentation

## Merging Tiles

If your simulation generated multiple tiles, you may want to merge them into a single raster for easier visualization and analysis.

### Using GDAL

```bash
# Merge all UTCI tiles
gdal_merge.py -o UTCI_merged.tif Outputs/*/UTCI_*.tif -separate

# Merge with compression
gdal_merge.py -o UTCI_merged.tif -co COMPRESS=LZW Outputs/*/UTCI_*.tif -separate
```

### Using Python

```python
from osgeo import gdal
import glob

# Find all UTCI tiles
utci_files = sorted(glob.glob('Outputs/*/UTCI_*.tif'))

# Merge using GDAL's Warp
gdal.Warp('UTCI_merged.tif', utci_files, format='GTiff',
          options=['COMPRESS=LZW'])
```

## Data Analysis

### Computing Statistics

```python
import numpy as np
from osgeo import gdal

# Open UTCI file
ds = gdal.Open('Outputs/tile_0_0/UTCI_0_0.tif')

# Compute statistics for each hour
for hour in range(1, ds.RasterCount + 1):
    band = ds.GetRasterBand(hour)
    utci = band.ReadAsArray()
    
    print(f"Hour {hour-1}:")
    print(f"  Mean UTCI: {np.mean(utci):.1f}°C")
    print(f"  Max UTCI: {np.max(utci):.1f}°C")
    print(f"  Min UTCI: {np.min(utci):.1f}°C")
    print(f"  Std UTCI: {np.std(utci):.1f}°C")
```

### Extracting Time Series

```python
import numpy as np
from osgeo import gdal

# Open UTCI file
ds = gdal.Open('Outputs/tile_0_0/UTCI_0_0.tif')

# Define a point of interest (pixel coordinates)
x, y = 500, 500

# Extract time series
utci_timeseries = []
for hour in range(1, ds.RasterCount + 1):
    band = ds.GetRasterBand(hour)
    utci = band.ReadAsArray()
    utci_timeseries.append(utci[y, x])

# Plot time series
import matplotlib.pyplot as plt
plt.figure(figsize=(12, 4))
plt.plot(range(24), utci_timeseries, marker='o')
plt.xlabel('Hour of Day')
plt.ylabel('UTCI (°C)')
plt.title('UTCI Time Series at Point (500, 500)')
plt.grid(True)
plt.tight_layout()
plt.savefig('utci_timeseries.png', dpi=300)
plt.show()
```

## Best Practices

!!! tip "Output Management"
    - Only save outputs you need to conserve disk space
    - Use compression when merging tiles (`COMPRESS=LZW`)
    - Document your output location and naming convention
    - Keep a log of simulation parameters with outputs

!!! warning "NoData Values"
    Check for and handle NoData values appropriately when computing statistics or creating visualizations. NoData typically appears at the edges of tiles or in areas outside the study domain.
