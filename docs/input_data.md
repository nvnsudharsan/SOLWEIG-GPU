# Input Data

SOLWEIG-GPU requires two main types of input data: geospatial rasters and meteorological forcing data. This guide provides detailed information on how to prepare and format your input data.

## Geospatial Rasters

All input rasters must be in **GeoTIFF format** and share the same properties to ensure proper alignment and processing.

### Requirements

!!! warning "Critical Requirements"
    All input rasters must have:
    
    - Identical Coordinate Reference System (CRS)
    - Same dimensions (width and height in pixels)
    - Same pixel size (spatial resolution)
    - Proper alignment (same geotransform)

The package includes validation checks that will raise errors if these requirements are not met.

### Required Rasters

#### Building DSM

**Filename:** `Building_DSM.tif` (default)

A Digital Surface Model that includes the height of both buildings and terrain. This raster represents the top surface of all features in the urban environment.

**Data Type:** Float32  
**Units:** Meters above a reference datum  
**NoData Value:** Should be properly set for areas outside the study domain

!!! tip "Creating Building DSM"
    Building DSM can be created by combining:
    
    - LiDAR point cloud data
    - Photogrammetric 3D models
    - Building footprints with height attributes merged with terrain elevation

#### Digital Elevation Model (DEM)

**Filename:** `DEM.tif` (default)

A Digital Elevation Model representing the bare-earth terrain, excluding buildings and vegetation. This represents the ground surface.

**Data Type:** Float32  
**Units:** Meters above a reference datum  
**NoData Value:** Should match Building DSM

!!! tip "DEM Sources"
    High-quality DEMs can be obtained from:
    
    - National elevation datasets (e.g., USGS 3DEP for USA)
    - LiDAR-derived bare-earth models
    - SRTM or ASTER GDEM for global coverage (lower resolution)

#### Tree DSM

**Filename:** `Trees.tif` (default)

A Digital Surface Model representing vegetation height only. This should contain the height of trees and other vegetation above ground level.

**Data Type:** Float32  
**Units:** Meters  
**Values:** Height of vegetation (0 for non-vegetated areas)

!!! info "Vegetation Height"
    The Tree DSM should represent the height of vegetation canopy above the ground surface, not above the reference datum. Areas without vegetation should have a value of 0.

#### Land Cover (Optional)

**Filename:** `Landcover.tif` (optional)

A raster representing land cover types. If not provided, the model will assume default land cover properties.

**Data Type:** Integer  
**Values:** Land cover classification codes

The package uses the classification scheme defined in `landcoverclasses_2016a.txt`. Key classes include:

| Code | Description |
|------|-------------|
| 1 | Paved surfaces |
| 2 | Buildings |
| 3 | Water |
| 4 | Vegetation |
| 5 | Bare soil |

## Meteorological Forcing Data

SOLWEIG-GPU supports three different types of meteorological data sources. You must choose one of these options for your simulation.

### Option 1: Custom Text File (UMEP Format)

A text file with a specific format, typically generated by the UMEP (Urban Multi-scale Environmental Predictor) tool.

**Format:** Space-delimited text file with header

**Required Columns:**

| Column | Description | Units |
|--------|-------------|-------|
| Year | Year | - |
| DOY | Day of year | 1-366 |
| Hour | Hour of day | 0-23 |
| Min | Minute | 0-59 |
| Ta | Air temperature | °C |
| RH | Relative humidity | % |
| G | Global radiation | W/m² |
| D | Diffuse radiation | W/m² |
| I | Direct radiation | W/m² |
| Ws | Wind speed | m/s |
| Wd | Wind direction | degrees |
| P | Atmospheric pressure | hPa |

**Example:**

```
Year DOY Hour Min Ta RH G D I Ws Wd P
2020 225 0 0 22.5 65 0 0 0 2.1 180 1013
2020 225 1 0 21.8 68 0 0 0 1.9 175 1013
2020 225 2 0 21.2 70 0 0 0 1.7 170 1013
```

!!! note "Time Zone"
    The time in the custom meteorological file should be in local time for the study area.

### Option 2: ERA5 Reanalysis Data

NetCDF files from the Copernicus Climate Data Store containing ERA5 reanalysis data.

**Required Files:** Both instantaneous and accumulated data files

**Required Variables:**

| Variable | Description | Units |
|----------|-------------|-------|
| t2m | 2-meter air temperature | K |
| d2m | 2-meter dew point temperature | K |
| sp | Surface pressure | Pa |
| u10 | 10-meter U wind component | m/s |
| v10 | 10-meter V wind component | m/s |
| ssrd | Surface solar radiation downwards (accumulated) | J/m² |
| strd | Surface thermal radiation downwards (accumulated) | J/m² |

**File Naming:** ERA5 files should be named according to the standard ERA5 naming convention.

!!! info "Downloading ERA5 Data"
    ERA5 data can be downloaded from the [Copernicus Climate Data Store](https://cds.climate.copernicus.eu/). You will need to register for a free account.

!!! warning "Time Specification"
    When using ERA5 data, you must specify `start_time` and `end_time` in **UTC**. The package will automatically convert to local time based on the location of your study area.

### Option 3: WRF Output Files

Output files from the Weather Research and Forecasting (WRF) model.

**File Format:** NetCDF (wrfout files)

**Filename Pattern:** Must follow one of these patterns:

- `wrfout_d0X_YYYY-MM-DD_HH_MM_SS` (recommended, works across all operating systems)
- `wrfout_d0X_YYYY-MM-DD_HH:MM:SS`
- `wrfout_d0X_YYYY-MM-DD_HH`

Where `X` is the domain number (1-9).

**Required Variables:** The package will automatically extract the necessary meteorological variables from the WRF output files.

!!! warning "Time Specification"
    When using WRF data, you must specify `start_time` and `end_time` in **UTC**. The package will automatically convert to local time.

## Data Preparation Tips

### Coordinate Reference System

Choose an appropriate projected coordinate system for your study area. UTM zones are commonly used for urban-scale studies.

!!! tip "CRS Selection"
    - Use a projected CRS (not geographic lat/lon)
    - UTM zones work well for most applications
    - Ensure all rasters use the same CRS

### Spatial Resolution

The appropriate spatial resolution depends on your study objectives and computational resources.

**Recommended Resolutions:**

- **High detail:** 0.5 - 2 meters (building-scale features)
- **Urban block:** 2 - 5 meters (neighborhood-scale)
- **District:** 5 - 10 meters (city-district scale)

!!! warning "Memory Considerations"
    Higher resolution requires more memory. Use the `tile_size` parameter to manage memory usage for large domains.

### Temporal Resolution

Currently, SOLWEIG-GPU is tested and optimized for **hourly data**. Sub-hourly or multi-hourly data may require modifications to the code.

## Sample Data

A complete sample dataset is available for download to help you understand the expected data format and structure.

**Download:** [Sample Data on Zenodo](https://doi.org/10.5281/zenodo.17048978)

The sample dataset includes:

- Example input rasters for Austin, Texas
- Meteorological forcing data in all three formats (custom text, ERA5, WRF)
- Expected output structure

!!! tip "Learning with Sample Data"
    We recommend starting with the sample data to familiarize yourself with the package before processing your own data.
